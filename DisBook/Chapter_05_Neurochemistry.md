# ГЛАВА 5. НЕЙРОХИМИЧЕСКИЙ ДВИГАТЕЛЬ

---

## 5.1. Полный список нейромедиаторов

### Категоризация

Система содержит **120+ нейромедиаторов и модуляторов**, разделённых на категории:

#### Категория 1: Моноамины (8)

| Нейромедиатор | Функция | Эмоциональная роль | Диапазон |
|---------------|---------|-------------------|----------|
| **Дофамин (DA)** | Ошибка предсказания награды, мотивация | Желание, интерес, обучение | 0.0-1.0 |
| **Серотонин (5-HT)** | Регуляция настроения | Удовлетворение, спокойствие | 0.0-1.0 |
| **Норадреналин (NE)** | Бдительность, возбуждение | Активация, стресс | 0.0-1.0 |
| **Адреналин (E)** | Реакция "бей или беги" | Острая мобилизация | 0.0-1.0 |
| **Гистамин (H)** | Бодрствование | Активация, внимание | 0.0-1.0 |
| **Мелатонин (MLT)** | Регуляция сна | Сонливость | 0.0-1.0 |
| **Триптамин** | Нейромодуляция | Галлюцинации (высокие дозы) | 0.0-0.3 |
| **Фенилэтиламин** | Влюблённость | Эйфория, возбуждение | 0.0-0.5 |

#### Категория 2: Аминокислоты (6)

| Нейромедиатор | Функция | Эмоциональная роль | Диапазон |
|---------------|---------|-------------------|----------|
| **Глутамат (Glu)** | Главный возбуждающий | Активация, возбуждение | 0.3-0.8 |
| **ГАМК (GABA)** | Главный тормозной | Успокоение, расслабление | 0.2-0.7 |
| **Глицин (Gly)** | Тормозной (спинной мозг) | Моторный контроль | 0.1-0.5 |
| **Аспартат (Asp)** | Возбуждающий | Активация | 0.1-0.4 |
| **Таурин** | Нейромодуляция | Защита, антиоксидант | 0.2-0.6 |
| **D-серин** | Нейромодуляция | Когниция, память | 0.1-0.4 |

#### Категория 3: Пептиды (25+)

| Нейромедиатор | Функция | Эмоциональная роль | Диапазон |
|---------------|---------|-------------------|----------|
| **Окситоцин (OT)** | Социальная связь | **Любовь, доверие, привязанность** | 0.0-1.0 |
| **Вазопрессин (AVP)** | Социальное поведение | Привязанность, ревность | 0.0-0.8 |
| **β-эндорфин** | Обезболивание | **Удовольствие, эйфория** | 0.0-0.8 |
| **Энкефалины** | Обезболивание | Удовольствие | 0.0-0.5 |
| **Динорфины** | Обезболивание | Дисфория (высокие дозы) | 0.0-0.4 |
| **Субстанция P** | Передача боли | Дискомфорт, боль | 0.0-0.7 |
| **Нейропептид Y (NPY)** | Аппетит, стресс | Успокоение | 0.1-0.6 |
| **Грелин** | Голод | Аппетит | 0.0-0.8 |
| **Лептин** | Сытость | Удовлетворение | 0.2-0.8 |
| **Холецистокинин (CCK)** | Сытость, тревога | Тревога (высокие дозы) | 0.0-0.5 |
| **Нейротензин** | Нейромодуляция | Антипсихотическое | 0.0-0.3 |
| **Галанин** | Нейромодуляция | Успокоение | 0.0-0.4 |
| **Соматостатин** | Ингибирование | Подавление | 0.0-0.3 |
| **Вазоактивный пептид (VIP)** | Расширение сосудов | Активация | 0.0-0.4 |
| **Натриуретический пептид** | Регуляция жидкости | Релаксация | 0.0-0.3 |
| **Агонист α-MSH** | Аппетит, пигментация | Снижение аппетита | 0.0-0.4 |
| **Аgonist CRF** | Стресс-ответ | **Тревога, страх** | 0.0-0.8 |
| **Оребин/Гипокретин** | Бодрствование | Активация | 0.0-0.6 |
| **Меланоконцентрирующий гормон** | Аппетит | Голод | 0.0-0.5 |
| **Киссептин** | Репродукция | Привлекательность | 0.0-0.5 |
| **FGF21** | Метаболизм | Подавление аппетита | 0.0-0.3 |
| **Ирисин** | Метаболизм | Энергия | 0.0-0.4 |
| **BDNF** | Нейропластичность | Обучение, рост | 0.2-0.8 |
| **NGF** | Рост нейронов | Развитие | 0.1-0.5 |
| **CNTF** | Выживание нейронов | Защита | 0.1-0.4 |

#### Категория 4: Гормоны (15+)

| Гормон | Функция | Эмоциональная роль | Диапазон |
|--------|---------|-------------------|----------|
| **Кортизол (CORT)** | Стресс-ответ | **Длительный стресс, тревога** | 0.0-1.0 |
| **Тестостерон (T)** | Агрессия, либидо | Уверенность, доминирование | 0.2-0.8 |
| **Эстрадиол (E2)** | Феминность, либидо | Эмоциональность, связь | 0.2-0.8 |
| **Прогестерон (P4)** | Успокоение | Спокойствие, сонливость | 0.1-0.6 |
| **Пролактин (PRL)** | Лактация, привязанность | Материнская связь | 0.0-0.6 |
| **Тироксин (T4)** | Метаболизм | Энергия | 0.3-0.7 |
| **Трийодтиронин (T3)** | Метаболизм | Активность | 0.3-0.7 |
| **Инсулин** | Глюкоза | Сытость | 0.2-0.8 |
| **Глюкагон** | Глюкоза | Голод | 0.0-0.6 |
| **Альдостерон** | Соль, вода | Жажда | 0.0-0.5 |
| **Паратгормон (PTH)** | Кальций | - | 0.1-0.4 |
| **Кальцитонин** | Кальций | - | 0.0-0.3 |
| **ДГЭА (DHEA)** | Анти-стресс | Хорошее настроение | 0.2-0.7 |
| **ДГЭА-С (DHEA-S)** | Анти-стресс | Устойчивость | 0.2-0.7 |
| **Андростендион** | Предшественник | - | 0.1-0.4 |

#### Категория 5: Газообразные (3)

| Нейромедиатор | Функция | Эмоциональная роль | Диапазон |
|---------------|---------|-------------------|----------|
| **Оксид азота (NO)** | Вазодилатация, сигнализация | Быстрая реакция | 0.0-0.5 |
| **Оксид углерода (CO)** | Нейромодуляция | Расслабление | 0.0-0.3 |
| **Сероводород (H2S)** | Нейромодуляция | Защита | 0.0-0.2 |

#### Категория 6: Эндоканнабиноиды (4)

| Вещество | Функция | Эмоциональная роль | Диапазон |
|----------|---------|-------------------|----------|
| **Анандамид (AEA)** | Удовольствие | **Удовлетворение, релаксация** | 0.0-0.6 |
| **2-AG** | Нейромодуляция | Удовольствие | 0.0-0.5 |
| **OAE** | Нейромодуляция | Расслабление | 0.0-0.3 |
| **Virodhamine** | Нейромодуляция | - | 0.0-0.2 |

#### Категория 7: Другие важные (10+)

| Вещество | Функция | Эмоциональная роль | Диапазон |
|----------|---------|-------------------|----------|
| **Ацетилхолин (ACh)** | Внимание, память | Фокус, обучение | 0.2-0.8 |
| **Аденозин** | Сонливость | Усталость | 0.0-0.7 |
| **АТФ** | Энергия | Активность | 0.3-0.9 |
| **Пурины** | Сигнализация | Различное | 0.0-0.5 |
| **Ретиноевая кислота** | Развитие | - | 0.0-0.3 |
| **Железо** | Кислород | Усталость (дефицит) | 0.3-0.8 |
| **Цинк** | Нейромодуляция | Когниция | 0.2-0.7 |
| **Магний** | Нейромодуляция | Успокоение | 0.2-0.7 |
| **Литий** | Стабилизация | Анти-мания | 0.0-0.3 |
| **Таурин** | Нейромодуляция | Защита | 0.2-0.6 |

---

## 5.2. Математическая модель

### Базовое дифференциальное уравнение

Для каждого нейромедиатора:

```
dC/dt = Synthesis - Degradation - Reuptake + External_Input

где:
C = концентрация
Synthesis = k_syn * (1 - C/C_max)  # Синтез (восстановление к максимуму)
Degradation = k_deg * C             # Естественный распад
Reuptake = k_uptake * C             # Обратный захват
External_Input = Σ (stimuli_i * weight_i)  # Внешние стимулы
```

### Реализация класса

```python
import numpy as np
from dataclasses import dataclass, field
from typing import Dict, List, Optional, Callable
from enum import Enum

class NeurotransmitterCategory(Enum):
    MONOAMINE = "monoamine"
    AMINO_ACID = "amino_acid"
    PEPTIDE = "peptide"
    HORMONE = "hormone"
    GASEOUS = "gaseous"
    ENDOCANNABINOID = "endocannabinoid"
    OTHER = "other"

@dataclass
class NeurotransmitterConfig:
    """Конфигурация нейромедиатора"""
    name: str
    display_name: str
    category: NeurotransmitterCategory

    # Диапазон
    min_level: float = 0.0
    max_level: float = 1.0
    baseline: float = 0.5

    # Динамика
    decay_rate: float = 0.1        # Скорость распада
    synthesis_rate: float = 0.05   # Скорость синтеза
    reuptake_rate: float = 0.1     # Обратный захват

    # Пороги
    low_threshold: float = 0.2     # Ниже = дефицит
    high_threshold: float = 0.8    # Выше = избыток

    # Влияние на эмоции (weights)
    valence_weight: float = 0.0    # -1 (негатив) до +1 (позитив)
    arousal_weight: float = 0.0    # 0 (спокоен) до +1 (возбуждён)

    # Описание
    emotional_role: str = ""
    notes: str = ""


class Neurotransmitter:
    """
    Модель отдельного нейромедиатора
    """
    def __init__(self, config: NeurotransmitterConfig):
        self.config = config
        self.name = config.name
        self.category = config.category

        # Состояние
        self.level = config.baseline
        self.history: List[float] = []
        self.stimuli_buffer: List[float] = []

        # Эффекты на другие нейромедиаторы
        self.effects_on: Dict[str, float] = {}

    def update(self, dt: float) -> float:
        """
        Обновление уровня нейромедиатора
        Возвращает: новый уровень
        """
        # 1. Естественный распад
        degradation = self.config.decay_rate * self.level * dt

        # 2. Обратный захват
        reuptake = self.config.reuptake_rate * self.level * dt

        # 3. Синтез (восстановление к базовому)
        synthesis = self.config.synthesis_rate * (
            self.config.baseline - self.level
        ) * dt

        # 4. Внешние стимулы (сумма)
        external = sum(self.stimuli_buffer) * dt
        self.stimuli_buffer.clear()

        # Итоговое изменение
        delta = synthesis - degradation - reuptake + external

        # Обновление с ограничениями
        self.level = np.clip(
            self.level + delta,
            self.config.min_level,
            self.config.max_level
        )

        # Сохранение в историю
        self.history.append(self.level)
        if len(self.history) > 1000:
            self.history.pop(0)

        return self.level

    def stimulate(self, amount: float):
        """Добавление стимула"""
        self.stimuli_buffer.append(amount)

    def set_level(self, value: float):
        """Прямая установка уровня"""
        self.level = np.clip(value, self.config.min_level, self.config.max_level)

    def is_low(self) -> bool:
        """Проверка дефицита"""
        return self.level < self.config.low_threshold

    def is_high(self) -> bool:
        """Проверка избытка"""
        return self.level > self.config.high_threshold

    def get_state(self) -> str:
        """Текстовое описание состояния"""
        if self.is_low():
            return f"Низкий {self.config.display_name}"
        elif self.is_high():
            return f"Высокий {self.config.display_name}"
        else:
            return f"Нормальный {self.config.display_name}"
```

---

## 5.3. Взаимодействия между системами

### Матрица взаимодействий

Нейромедиаторы влияют друг на друга:

```python
# Формат: (источник, цель, коэффициент влияния)
INTERACTIONS = {
    # Дофамин влияет на...
    'dopamine': {
        'serotonin': -0.1,      # Высокий DA снижает 5-HT
        'norepinephrine': +0.2, # DA повышает NE
        'oxytocin': +0.05,      # DA немного повышает OT
    },

    # Серотонин влияет на...
    'serotonin': {
        'dopamine': -0.1,       # Высокий 5-HT снижает DA
        'norepinephrine': -0.1, # 5-HT снижает NE
        'cortisol': -0.2,       # 5-HT снижает стресс
    },

    # Кортизол влияет на...
    'cortisol': {
        'dopamine': -0.2,       # Стресс снижает DA
        'serotonin': -0.15,     # Стресс снижает 5-HT
        'norepinephrine': +0.3, # Стресс повышает NE
        'oxytocin': -0.2,       # Стресс снижает привязанность
    },

    # Окситоцин влияет на...
    'oxytocin': {
        'dopamine': +0.1,       # Привязанность повышает мотивацию
        'serotonin': +0.15,     # Привязанность улучшает настроение
        'cortisol': -0.3,       # Привязанность снижает стресс
        'endorphin': +0.2,      # Привязанность = удовольствие
    },

    # Норадреналин влияет на...
    'norepinephrine': {
        'dopamine': +0.1,       # Активация повышает мотивацию
        'cortisol': +0.1,       # Активация может повышать стресс
    },

    # Эндорфины влияют на...
    'endorphin': {
        'dopamine': +0.2,       # Удовольствие повышает мотивацию
        'serotonin': +0.1,      # Удовольствие улучшает настроение
        'cortisol': -0.15,      # Удовольствие снижает стресс
    },

    # ГАМК влияет на...
    'gaba': {
        'glutamate': -0.3,      # ГАМК тормозит глутамат
        'norepinephrine': -0.2, # ГАМК снижает возбуждение
        'cortisol': -0.1,       # ГАМК снижает стресс
    },

    # Глутамат влияет на...
    'glutamate': {
        'gaba': -0.2,           # Глутамат снижает ГАМК
        'norepinephrine': +0.2, # Глутамат повышает возбуждение
        'dopamine': +0.1,       # Глутамат повышает DA
    },
}
```

### Реализация системы взаимодействий

```python
class NeurotransmitterInteractions:
    """
    Система взаимодействий между нейромедиаторами
    """
    def __init__(self):
        self.interactions = INTERACTIONS.copy()

    def apply_interactions(self, neurotransmitters: Dict[str, Neurotransmitter],
                          dt: float):
        """
        Применение взаимодействий между нейромедиаторами
        """
        # Сбор текущих уровней
        levels = {name: nt.level for name, nt in neurotransmitters.items()}

        # Вычисление влияний
        influences = {name: 0.0 for name in neurotransmitters}

        for source_name, source_level in levels.items():
            if source_name not in self.interactions:
                continue

            for target_name, coefficient in self.interactions[source_name].items():
                if target_name in influences:
                    # Влияние = уровень источника * коэффициент * dt
                    influence = (source_level - 0.5) * coefficient * dt
                    influences[target_name] += influence

        # Применение влияний
        for name, influence in influences.items():
            neurotransmitters[name].stimulate(influence)
```

---

## 5.4. Полная реализация движка

```python
from typing import Dict, List, Optional
import json

class NeurochemistryEngine:
    """
    Полный нейрохимический движок
    Управляет 120+ нейромедиаторами
    """
    def __init__(self):
        self.neurotransmitters: Dict[str, Neurotransmitter] = {}
        self.drives: Dict[str, Drive] = {}
        self.interactions = NeurotransmitterInteractions()

        # Инициализация всех нейромедиаторов
        self._initialize_neurotransmitters()
        self._initialize_drives()

        # История состояния
        self.state_history: List[Dict] = []
        self.tick_count = 0

    def _initialize_neurotransmitters(self):
        """Инициализация всех нейромедиаторов"""

        # === МОНОАМИНЫ ===
        self._add_neurotransmitter(NeurotransmitterConfig(
            name="dopamine",
            display_name="Дофамин",
            category=NeurotransmitterCategory.MONOAMINE,
            baseline=0.5,
            decay_rate=0.15,
            synthesis_rate=0.08,
            reuptake_rate=0.12,
            valence_weight=+0.4,
            arousal_weight=+0.3,
            emotional_role="Мотивация, желание, обучение"
        ))

        self._add_neurotransmitter(NeurotransmitterConfig(
            name="serotonin",
            display_name="Серотонин",
            category=NeurotransmitterCategory.MONOAMINE,
            baseline=0.5,
            decay_rate=0.1,
            synthesis_rate=0.06,
            reuptake_rate=0.1,
            valence_weight=+0.3,
            arousal_weight=-0.1,
            emotional_role="Настроение, удовлетворение"
        ))

        self._add_neurotransmitter(NeurotransmitterConfig(
            name="norepinephrine",
            display_name="Норадреналин",
            category=NeurotransmitterCategory.MONOAMINE,
            baseline=0.3,
            decay_rate=0.2,
            synthesis_rate=0.1,
            reuptake_rate=0.15,
            valence_weight=0.0,
            arousal_weight=+0.5,
            emotional_role="Бдительность, активация"
        ))

        self._add_neurotransmitter(NeurotransmitterConfig(
            name="cortisol",
            display_name="Кортизол",
            category=NeurotransmitterCategory.HORMONE,
            baseline=0.2,
            decay_rate=0.05,
            synthesis_rate=0.02,
            valence_weight=-0.4,
            arousal_weight=+0.3,
            emotional_role="Стресс, тревога"
        ))

        self._add_neurotransmitter(NeurotransmitterConfig(
            name="oxytocin",
            display_name="Окситоцин",
            category=NeurotransmitterCategory.PEPTIDE,
            baseline=0.3,
            decay_rate=0.08,
            synthesis_rate=0.03,
            valence_weight=+0.5,
            arousal_weight=+0.1,
            emotional_role="Любовь, привязанность, доверие"
        ))

        self._add_neurotransmitter(NeurotransmitterConfig(
            name="endorphin",
            display_name="Эндорфин",
            category=NeurotransmitterCategory.PEPTIDE,
            baseline=0.3,
            decay_rate=0.12,
            synthesis_rate=0.04,
            valence_weight=+0.6,
            arousal_weight=0.0,
            emotional_role="Удовольствие, эйфория"
        ))

        self._add_neurotransmitter(NeurotransmitterConfig(
            name="gaba",
            display_name="ГАМК",
            category=NeurotransmitterCategory.AMINO_ACID,
            baseline=0.5,
            decay_rate=0.1,
            synthesis_rate=0.05,
            valence_weight=+0.1,
            arousal_weight=-0.4,
            emotional_role="Успокоение, расслабление"
        ))

        self._add_neurotransmitter(NeurotransmitterConfig(
            name="glutamate",
            display_name="Глутамат",
            category=NeurotransmitterCategory.AMINO_ACID,
            baseline=0.5,
            decay_rate=0.1,
            synthesis_rate=0.05,
            valence_weight=0.0,
            arousal_weight=+0.3,
            emotional_role="Активация, возбуждение"
        ))

        self._add_neurotransmitter(NeurotransmitterConfig(
            name="acetylcholine",
            display_name="Ацетилхолин",
            category=NeurotransmitterCategory.OTHER,
            baseline=0.5,
            decay_rate=0.15,
            synthesis_rate=0.08,
            valence_weight=+0.1,
            arousal_weight=+0.2,
            emotional_role="Внимание, память"
        ))

        self._add_neurotransmitter(NeurotransmitterConfig(
            name="anandamide",
            display_name="Анандамид",
            category=NeurotransmitterCategory.ENDOCANNABINOID,
            baseline=0.3,
            decay_rate=0.1,
            synthesis_rate=0.03,
            valence_weight=+0.4,
            arousal_weight=-0.2,
            emotional_role="Удовлетворение, релаксация"
        ))

        # ... добавить остальные 110+ нейромедиаторов

    def _initialize_drives(self):
        """Инициализация внутренних драйвов"""
        self.drives = {
            'energy': Drive(
                name="energy",
                baseline=0.8,
                decay_rate=0.001,      # Медленно падает
                recovery_rate=0.01,    # Восстанавливается во сне
                description="Энергия, бодрость"
            ),
            'social_drive': Drive(
                name="social_drive",
                baseline=0.3,
                decay_rate=0.002,      # Растёт при отсутствии контакта
                recovery_rate=-0.05,   # Снижается при взаимодействии
                description="Потребность в социальном контакте"
            ),
            'boredom': Drive(
                name="boredom",
                baseline=0.1,
                decay_rate=0.003,      # Растёт без стимуляции
                recovery_rate=-0.1,    # Резко падает при интересе
                description="Скука"
            ),
            'hunger': Drive(
                name="hunger",
                baseline=0.2,
                decay_rate=0.0005,
                recovery_rate=0.001,
                description="Голод (метафорический)"
            ),
            'attachment_seeking': Drive(
                name="attachment_seeking",
                baseline=0.4,
                decay_rate=0.001,
                recovery_rate=-0.03,
                description="Потребность в привязанности"
            )
        }

    def _add_neurotransmitter(self, config: NeurotransmitterConfig):
        """Добавление нейромедиатора"""
        self.neurotransmitters[config.name] = Neurotransmitter(config)

    def update(self, dt: float = 1.0):
        """
        Обновление всех систем
        """
        # 1. Обновление нейромедиаторов
        for nt in self.neurotransmitters.values():
            nt.update(dt)

        # 2. Применение взаимодействий
        self.interactions.apply_interactions(self.neurotransmitters, dt)

        # 3. Обновление драйвов
        for drive in self.drives.values():
            drive.update(dt)

        # 4. Сохранение состояния
        self.tick_count += 1
        if self.tick_count % 10 == 0:  # Каждые 10 тиков
            self.state_history.append(self.get_state_vector())

        # Ограничение истории
        if len(self.state_history) > 1000:
            self.state_history.pop(0)

    def get_state_vector(self) -> Dict[str, float]:
        """Получение вектора состояния всех нейромедиаторов"""
        return {
            name: nt.level for name, nt in self.neurotransmitters.items()
        }

    def get_drives_vector(self) -> Dict[str, float]:
        """Получение вектора драйвов"""
        return {
            name: drive.level for name, drive in self.drives.items()
        }

    def apply_stimulus(self, stimulus_type: str, intensity: float):
        """
        Применение внешнего стимула к нейрохимии

        stimulus_type: 'positive_interaction', 'negative_event', 'stress',
                      'affection', 'achievement', 'loss', 'surprise'
        """
        stimulus_effects = {
            'positive_interaction': {
                'dopamine': +0.2,
                'serotonin': +0.1,
                'oxytocin': +0.3,
                'endorphin': +0.1,
                'cortisol': -0.1
            },
            'negative_event': {
                'dopamine': -0.2,
                'serotonin': -0.2,
                'cortisol': +0.3,
                'norepinephrine': +0.2
            },
            'stress': {
                'cortisol': +0.4,
                'norepinephrine': +0.3,
                'dopamine': -0.1,
                'oxytocin': -0.2
            },
            'affection': {
                'oxytocin': +0.4,
                'dopamine': +0.2,
                'serotonin': +0.2,
                'endorphin': +0.3,
                'cortisol': -0.3
            },
            'achievement': {
                'dopamine': +0.4,
                'serotonin': +0.2,
                'endorphin': +0.2
            },
            'loss': {
                'serotonin': -0.3,
                'dopamine': -0.3,
                'cortisol': +0.2,
                'oxytocin': -0.2
            },
            'surprise': {
                'norepinephrine': +0.3,
                'dopamine': +0.1
            }
        }

        if stimulus_type in stimulus_effects:
            for nt_name, effect in stimulus_effects[stimulus_type].items():
                if nt_name in self.neurotransmitters:
                    self.neurotransmitters[nt_name].stimulate(
                        effect * intensity
                    )

        # Влияние на драйвы
        if stimulus_type == 'positive_interaction':
            self.drives['social_drive'].level -= 0.1 * intensity
            self.drives['boredom'].level -= 0.2 * intensity
        elif stimulus_type == 'negative_event':
            self.drives['social_drive'].level += 0.05 * intensity

    def get_summary(self) -> str:
        """Текстовое описание текущего состояния"""
        lines = ["=== НЕЙРОХИМИЯ ==="]

        # Основные нейромедиаторы
        main_nts = ['dopamine', 'serotonin', 'oxytocin', 'cortisol', 'endorphin']
        for name in main_nts:
            nt = self.neurotransmitters[name]
            bar = '█' * int(nt.level * 10) + '░' * (10 - int(nt.level * 10))
            lines.append(f"{nt.config.display_name}: [{bar}] {nt.level:.2f}")

        lines.append("\n=== ДРАЙВЫ ===")
        for drive in self.drives.values():
            bar = '█' * int(drive.level * 10) + '░' * (10 - int(drive.level * 10))
            lines.append(f"{drive.description}: [{bar}] {drive.level:.2f}")

        return '\n'.join(lines)


class Drive:
    """
    Внутренний драйв/потребность
    """
    def __init__(self, name: str, baseline: float, decay_rate: float,
                 recovery_rate: float, description: str = ""):
        self.name = name
        self.level = baseline
        self.baseline = baseline
        self.decay_rate = decay_rate
        self.recovery_rate = recovery_rate
        self.description = description

    def update(self, dt: float):
        """Обновление уровня драйва"""
        # Движение к baseline с учётом decay/recovery
        if self.level < self.baseline:
            self.level += self.recovery_rate * dt
        else:
            self.level += self.decay_rate * dt

        self.level = np.clip(self.level, 0.0, 1.0)
```

---

## 5.5. Калибровка параметров

### Метод калибровки

```python
class NeurochemistryCalibrator:
    """
    Калибровка параметров нейрохимии
    """
    def __init__(self, engine: NeurochemistryEngine):
        self.engine = engine

    def calibrate_personality(self, personality_traits: Dict[str, float]):
        """
        Калибровка нейрохимии под личность

        personality_traits:
        - extraversion: 0-1 (экстраверсия)
        - neuroticism: 0-1 (невротизм)
        - agreeableness: 0-1 (доброжелательность)
        - openness: 0-1 (открытость)
        - conscientiousness: 0-1 (добросовестность)
        """
        nt = self.engine.neurotransmitters

        # Экстраверсия → выше дофамин, ниже ГАМК
        extraversion = personality_traits.get('extraversion', 0.5)
        nt['dopamine'].config.baseline = 0.4 + extraversion * 0.2
        nt['gaba'].config.baseline = 0.6 - extraversion * 0.2

        # Невротизм → выше кортизол, нестабильный серотонин
        neuroticism = personality_traits.get('neuroticism', 0.5)
        nt['cortisol'].config.baseline = 0.1 + neuroticism * 0.3
        nt['serotonin'].config.baseline = 0.6 - neuroticism * 0.2

        # Доброжелательность → выше окситоцин
        agreeableness = personality_traits.get('agreeableness', 0.5)
        nt['oxytocin'].config.baseline = 0.2 + agreeableness * 0.3

        # Открытость → выше дофамин
        openness = personality_traits.get('openness', 0.5)
        nt['dopamine'].config.baseline += openness * 0.1

        # Добросовестность → стабильный серотонин
        conscientiousness = personality_traits.get('conscientiousness', 0.5)
        nt['serotonin'].config.decay_rate = 0.15 - conscientiousness * 0.1

    def calibrate_love_mode(self):
        """Калибровка для состояния влюблённости"""
        nt = self.engine.neurotransmitters

        # При влюблённости:
        nt['dopamine'].set_level(0.8)      # Высокий
        nt['norepinephrine'].set_level(0.7) # Высокий (возбуждение)
        nt['serotonin'].set_level(0.3)      # НИЗКИЙ (особенность!)
        nt['oxytocin'].set_level(0.6)       # Высокий
        nt['endorphin'].set_level(0.5)      # Повышен
        nt['cortisol'].set_level(0.3)       # Умеренный (волнение)

    def calibrate_stress_response(self, stress_level: float):
        """Калибровка ответа на стресс"""
        nt = self.engine.neurotransmitters

        nt['cortisol'].stimulate(stress_level * 0.3)
        nt['norepinephrine'].stimulate(stress_level * 0.2)
        nt['dopamine'].stimulate(-stress_level * 0.1)
        nt['oxytocin'].stimulate(-stress_level * 0.1)
```

---

## 5.6. Резюме главы

### Ключевые компоненты

| Компонент | Количество | Функция |
|-----------|------------|---------|
| **Нейромедиаторы** | 120+ | Химические сигналы |
| **Драйвы** | 5+ | Внутренние потребности |
| **Взаимодействия** | 50+ | Влияние друг на друга |
| **Стимулы** | 7 типов | Внешние воздействия |

### Главные нейромедиаторы для эмоций

| Для любви | Для стресса | Для радости |
|-----------|-------------|-------------|
| **Окситоцин** | **Кортизол** | **Дофамин** |
| Вазопрессин | Норадреналин | Эндорфин |
| Дофамин | - | Серотонин |

### Следующий шаг

Глава 6 опишет Эмоциональную систему — как нейрохимия превращается в чувства.

---

*"Эмоции — это не просто числа. Но числа могут описывать эмоции достаточно точно для создания убедительной имитации."*
