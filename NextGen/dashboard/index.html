<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYNAPSE Control Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&family=DM+Mono&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'DM Sans', sans-serif; background: #060A12; color: white; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 2px; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .spin { animation: spin 1s linear infinite; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;
        const { AreaChart, Area, ResponsiveContainer, Tooltip, LineChart, Line, XAxis, YAxis } = Recharts;

        // ‚îÄ‚îÄ Configuration ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const API_URL = "http://localhost:8000";
        const WS_URL = "ws://localhost:8000/ws";

        // ‚îÄ‚îÄ API Functions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function api(endpoint, method = "GET", body = null) {
            try {
                const opts = { method, headers: { "Content-Type": "application/json" } };
                if (body) opts.body = JSON.stringify(body);
                const res = await fetch(`${API_URL}${endpoint}`, opts);
                return await res.json();
            } catch (e) {
                console.error("API Error:", e);
                return null;
            }
        }

        // ‚îÄ‚îÄ Components ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

        function StatusBadge({ state }) {
            const colors = {
                idle: { bg: "rgba(150,150,150,0.2)", border: "rgba(150,150,150,0.4)", color: "#999" },
                running: { bg: "rgba(78,205,196,0.2)", border: "rgba(78,205,196,0.4)", color: "#4ECDC4" },
                paused: { bg: "rgba(255,217,61,0.2)", border: "rgba(255,217,61,0.4)", color: "#FFD93D" },
                stopping: { bg: "rgba(255,107,157,0.2)", border: "rgba(255,107,157,0.4)", color: "#FF6B9D" }
            };
            const c = colors[state] || colors.idle;

            return (
                <div style={{
                    display: "inline-flex", alignItems: "center", gap: 6,
                    padding: "4px 12px", borderRadius: 20,
                    background: c.bg, border: `1px solid ${c.border}`,
                }}>
                    <div style={{
                        width: 6, height: 6, borderRadius: "50%",
                        background: c.color,
                        boxShadow: `0 0 8px ${c.color}`,
                        animation: state === "running" ? "pulse 1s infinite" : "none"
                    }} />
                    <span style={{ fontSize: 11, color: c.color, fontFamily: "monospace" }}>
                        {state.toUpperCase()}
                    </span>
                </div>
            );
        }

        function Button({ onClick, children, variant = "default", disabled, style }) {
            const variants = {
                default: { bg: "rgba(255,255,255,0.1)", border: "rgba(255,255,255,0.2)", color: "#fff" },
                primary: { bg: "rgba(78,205,196,0.2)", border: "rgba(78,205,196,0.4)", color: "#4ECDC4" },
                danger: { bg: "rgba(255,107,157,0.2)", border: "rgba(255,107,157,0.4)", color: "#FF6B9D" },
                warning: { bg: "rgba(255,217,61,0.2)", border: "rgba(255,217,61,0.4)", color: "#FFD93D" },
                success: { bg: "rgba(168,230,207,0.2)", border: "rgba(168,230,207,0.4)", color: "#A8E6CF" }
            };
            const v = variants[variant];

            return (
                <button
                    onClick={onClick}
                    disabled={disabled}
                    style={{
                        padding: "8px 16px", borderRadius: 8, border: `1px solid ${v.border}`,
                        background: v.bg, color: v.color, cursor: disabled ? "not-allowed" : "pointer",
                        fontFamily: "'DM Sans', sans-serif", fontSize: 12, fontWeight: 500,
                        opacity: disabled ? 0.5 : 1, transition: "all 0.2s",
                        ...style
                    }}
                >
                    {children}
                </button>
            );
        }

        function Input({ value, onChange, placeholder, type = "text", style }) {
            return (
                <input
                    type={type}
                    value={value}
                    onChange={e => onChange(e.target.value)}
                    placeholder={placeholder}
                    style={{
                        width: "100%", padding: "8px 12px", borderRadius: 6,
                        background: "rgba(255,255,255,0.05)", border: "1px solid rgba(255,255,255,0.1)",
                        color: "#fff", fontSize: 12, outline: "none",
                        ...style
                    }}
                />
            );
        }

        function MetricCard({ label, value, color, unit = "" }) {
            return (
                <div style={{
                    padding: "12px 14px",
                    background: "rgba(255,255,255,0.03)",
                    borderRadius: 8,
                    border: `1px solid ${color}33`
                }}>
                    <div style={{ fontSize: 9, color: "rgba(255,255,255,0.4)", fontFamily: "monospace", marginBottom: 4 }}>
                        {label}
                    </div>
                    <div style={{ fontSize: 20, fontWeight: 600, color, fontFamily: "monospace" }}>
                        {typeof value === "number" ? value.toFixed(3) : value}{unit}
                    </div>
                </div>
            );
        }

        function Gauge({ label, value, color }) {
            return (
                <div style={{ marginBottom: 8 }}>
                    <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 4 }}>
                        <span style={{ fontSize: 10, color: "rgba(255,255,255,0.5)" }}>{label}</span>
                        <span style={{ fontSize: 11, color, fontFamily: "monospace" }}>
                            {(value * 100).toFixed(0)}%
                        </span>
                    </div>
                    <div style={{ height: 4, background: "rgba(255,255,255,0.1)", borderRadius: 2 }}>
                        <div style={{
                            height: "100%", width: `${value * 100}%",
                            background: color, borderRadius: 2,
                            transition: "width 0.3s"
                        }} />
                    </div>
                </div>
            );
        }

        function Section({ title, children, defaultOpen = true }) {
            const [open, setOpen] = useState(defaultOpen);

            return (
                <div style={{
                    background: "rgba(255,255,255,0.02)",
                    borderRadius: 10, border: "1px solid rgba(255,255,255,0.06)",
                    marginBottom: 8, overflow: "hidden"
                }}>
                    <div
                        onClick={() => setOpen(!open)}
                        style={{
                            padding: "10px 14px", cursor: "pointer",
                            display: "flex", justifyContent: "space-between", alignItems: "center",
                            borderBottom: open ? "1px solid rgba(255,255,255,0.04)" : "none"
                        }}
                    >
                        <span style={{ fontSize: 11, color: "rgba(255,255,255,0.7)", fontFamily: "monospace" }}>
                            {title}
                        </span>
                        <span style={{ color: "rgba(255,255,255,0.3)" }}>{open ? "‚ñº" : "‚ñ∂"}</span>
                    </div>
                    {open && <div style={{ padding: 12 }}>{children}</div>}
                </div>
            );
        }

        // ‚îÄ‚îÄ Main Dashboard ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

        function SynapseDashboard() {
            // State
            const [connected, setConnected] = useState(false);
            const [status, setStatus] = useState({ state: "idle", step: 0, elapsed_human: "0s" });
            const [metrics, setMetrics] = useState({});
            const [neurochemistry, setNeurochemistry] = useState({
                dopamine: 0.5, serotonin: 0.5, oxytocin: 0.5, cortisol: 0.3, norepinephrine: 0.4
            });
            const [metricsHistory, setMetricsHistory] = useState([]);
            const [checkpoints, setCheckpoints] = useState([]);
            const [messages, setMessages] = useState([]);
            const [input, setInput] = useState("");
            const [loading, setLoading] = useState({});

            // Config states
            const [stopConditions, setStopConditions] = useState({
                max_steps: "", max_hours: "", max_samples: "", target_phi: "", target_agency: ""
            });
            const [neurogenesisConfig, setNeurogenesisConfig] = useState({
                enabled: true, max_neurons: 100000, threshold: 0.85, rate: 0.1
            });
            const [trainingConfig, setTrainingConfig] = useState({
                learning_rate: 0.0001, batch_size: 16, save_interval: 300
            });

            const chatRef = useRef();
            const wsRef = useRef();

            // WebSocket
            useEffect(() => {
                const connect = () => {
                    wsRef.current = new WebSocket(WS_URL);
                    wsRef.current.onopen = () => setConnected(true);
                    wsRef.current.onmessage = (e) => {
                        const data = JSON.parse(e.data);
                        if (data.type === "status" || data.type === "metrics") {
                            setStatus(prev => ({ ...prev, ...data }));
                            if (data.metrics) {
                                setMetrics(data.metrics);
                                setMetricsHistory(prev => [...prev.slice(-100), {
                                    ...data.metrics, time: data.elapsed_seconds || 0
                                }]);
                            }
                        }
                    };
                    wsRef.current.onclose = () => {
                        setConnected(false);
                        setTimeout(connect, 2000);
                    };
                };
                connect();
                return () => wsRef.current?.close();
            }, []);

            // Load data
            useEffect(() => {
                const load = async () => {
                    const s = await api("/api/status");
                    if (s) setStatus(prev => ({ ...prev, ...s }));

                    const c = await api("/api/checkpoints");
                    if (c) setCheckpoints(c);

                    const n = await api("/api/neurogenesis");
                    if (n) setNeurogenesisConfig(prev => ({ ...prev, ...n }));

                    const h = await api("/api/chat/history");
                    if (h) setMessages(h);
                };
                load();
                const interval = setInterval(load, 5000);
                return () => clearInterval(interval);
            }, []);

            // Scroll chat
            useEffect(() => {
                if (chatRef.current) chatRef.current.scrollTop = chatRef.current.scrollHeight;
            }, [messages]);

            // API calls with loading state
            const call = async (endpoint, method, body, key) => {
                setLoading(prev => ({ ...prev, [key]: true }));
                const res = await api(endpoint, method, body);
                setLoading(prev => ({ ...prev, [key]: false }));

                // Refresh status
                const s = await api("/api/status");
                if (s) setStatus(prev => ({ ...prev, ...s }));

                return res;
            };

            // Training controls
            const startTraining = () => call("/api/training/start", "POST", null, "start");
            const pauseTraining = () => call("/api/training/pause", "POST", null, "pause");
            const resumeTraining = () => call("/api/training/resume", "POST", null, "resume");
            const stopTraining = () => {
                if (confirm("Stop training? Progress will be saved.")) {
                    call("/api/training/stop", "POST", null, "stop");
                }
            };

            // Config updates
            const updateStopConditions = async () => {
                const body = {};
                if (stopConditions.max_steps) body.max_steps = parseInt(stopConditions.max_steps);
                if (stopConditions.max_hours) body.max_hours = parseFloat(stopConditions.max_hours);
                if (stopConditions.max_samples) body.max_samples = parseInt(stopConditions.max_samples);
                if (stopConditions.target_phi) body.target_phi = parseFloat(stopConditions.target_phi);
                if (stopConditions.target_agency) body.target_agency = parseFloat(stopConditions.target_agency);
                await call("/api/training/stop-conditions", "POST", body, "stopCond");
            };

            const updateNeurogenesis = async () => {
                await call("/api/neurogenesis/config", "POST", neurogenesisConfig, "neuro");
            };

            const toggleNeurogenesis = async () => {
                const newConfig = { ...neurogenesisConfig, enabled: !neurogenesisConfig.enabled };
                setNeurogenesisConfig(newConfig);
                await call("/api/neurogenesis/config", "POST", { enabled: newConfig.enabled }, "neuro");
            };

            // Checkpoints
            const saveCheckpoint = () => call("/api/checkpoint/save", "POST", null, "save");
            const loadCheckpoint = (path) => {
                if (confirm("Load checkpoint? Current progress will be lost.")) {
                    call(`/api/checkpoint/load?path=${encodeURIComponent(path)}`, "POST", null, "load");
                }
            };
            const resetModel = () => {
                if (confirm("Reset model? All progress will be lost!")) {
                    call("/api/reset", "POST", null, "reset");
                }
            };

            // Chat
            const sendMessage = async () => {
                if (!input.trim()) return;
                const res = await api("/api/chat", "POST", { text: input });
                setInput("");
                if (res) {
                    setMessages(prev => [...prev,
                        { from: "user", text: input, timestamp: new Date().toISOString() },
                        { from: "brain", text: res.response, timestamp: new Date().toISOString() }
                    ]);
                }
            };

            // Render
            const isRunning = status.state === "running";
            const isPaused = status.state === "paused";
            const isIdle = status.state === "idle";

            return (
                <div style={{ minHeight: "100vh", background: "#060A12" }}>
                    {/* Header */}
                    <div style={{
                        display: "flex", alignItems: "center", justifyContent: "space-between",
                        padding: "10px 16px", borderBottom: "1px solid rgba(255,255,255,0.06)",
                        background: "rgba(6,10,18,0.95)", position: "sticky", top: 0, zIndex: 100
                    }}>
                        <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
                            <div style={{ display: "flex", alignItems: "center", gap: 6 }}>
                                <div style={{
                                    width: 8, height: 8, borderRadius: "50%",
                                    background: connected ? "#4ECDC4" : "#FF6B9D",
                                    boxShadow: `0 0 10px ${connected ? "#4ECDC4" : "#FF6B9D"}`
                                }} />
                                <span style={{ fontSize: 14, fontWeight: 600 }}>SYNAPSE</span>
                            </div>
                            <StatusBadge state={status.state} />
                        </div>
                        <div style={{ display: "flex", alignItems: "center", gap: 16, fontSize: 11, fontFamily: "monospace", color: "rgba(255,255,255,0.5)" }}>
                            <span>Step: {status.step?.toLocaleString()}</span>
                            <span>Time: {status.elapsed_human}</span>
                            <span>Neurons: {status.total_neurons?.toLocaleString()}</span>
                        </div>
                    </div>

                    {/* Main Layout */}
                    <div style={{ display: "grid", gridTemplateColumns: "280px 1fr 300px", height: "calc(100vh - 45px)" }}>

                        {/* Left: Controls */}
                        <div style={{
                            borderRight: "1px solid rgba(255,255,255,0.05)",
                            overflowY: "auto", padding: 10
                        }}>
                            {/* Training Controls */}
                            <Section title="‚ñ∂ TRAINING CONTROL">
                                <div style={{ display: "flex", gap: 6, marginBottom: 10 }}>
                                    {isIdle || isPaused ? (
                                        <Button
                                            variant="success"
                                            onClick={isPaused ? resumeTraining : startTraining}
                                            disabled={loading.start}
                                            style={{ flex: 1 }}
                                        >
                                            {isPaused ? "‚ñ∂ RESUME" : "‚ñ∂ START"}
                                        </Button>
                                    ) : null}

                                    {isRunning && (
                                        <Button variant="warning" onClick={pauseTraining} style={{ flex: 1 }}>
                                            ‚è∏ PAUSE
                                        </Button>
                                    )}

                                    {!isIdle && (
                                        <Button variant="danger" onClick={stopTraining} style={{ flex: 1 }}>
                                            ‚èπ STOP
                                        </Button>
                                    )}
                                </div>
                            </Section>

                            {/* Stop Conditions */}
                            <Section title="‚è± STOP CONDITIONS">
                                <div style={{ display: "grid", gap: 8 }}>
                                    <div>
                                        <label style={{ fontSize: 9, color: "rgba(255,255,255,0.4)" }}>Max Steps</label>
                                        <Input
                                            type="number"
                                            value={stopConditions.max_steps}
                                            onChange={v => setStopConditions(prev => ({ ...prev, max_steps: v }))}
                                            placeholder="e.g. 100000"
                                        />
                                    </div>
                                    <div>
                                        <label style={{ fontSize: 9, color: "rgba(255,255,255,0.4)" }}>Max Hours</label>
                                        <Input
                                            type="number"
                                            value={stopConditions.max_hours}
                                            onChange={v => setStopConditions(prev => ({ ...prev, max_hours: v }))}
                                            placeholder="e.g. 8"
                                        />
                                    </div>
                                    <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8 }}>
                                        <div>
                                            <label style={{ fontSize: 9, color: "rgba(255,255,255,0.4)" }}>Target Œ¶</label>
                                            <Input
                                                type="number"
                                                step="0.1"
                                                value={stopConditions.target_phi}
                                                onChange={v => setStopConditions(prev => ({ ...prev, target_phi: v }))}
                                                placeholder="0.7"
                                            />
                                        </div>
                                        <div>
                                            <label style={{ fontSize: 9, color: "rgba(255,255,255,0.4)" }}>Target Agency</label>
                                            <Input
                                                type="number"
                                                step="0.1"
                                                value={stopConditions.target_agency}
                                                onChange={v => setStopConditions(prev => ({ ...prev, target_agency: v }))}
                                                placeholder="0.7"
                                            />
                                        </div>
                                    </div>
                                    <Button onClick={updateStopConditions} variant="primary" style={{ width: "100%" }}>
                                        Apply Stop Conditions
                                    </Button>
                                </div>
                            </Section>

                            {/* Neurogenesis */}
                            <Section title="üß¨ NEUROGENESIS">
                                <div style={{ marginBottom: 10 }}>
                                    <label style={{
                                        display: "flex", alignItems: "center", gap: 8,
                                        cursor: "pointer", fontSize: 11
                                    }}>
                                        <input
                                            type="checkbox"
                                            checked={neurogenesisConfig.enabled}
                                            onChange={toggleNeurogenesis}
                                            style={{ width: 16, height: 16 }}
                                        />
                                        Enable Neurogenesis
                                    </label>
                                </div>

                                <div style={{ display: "grid", gap: 8 }}>
                                    <div>
                                        <label style={{ fontSize: 9, color: "rgba(255,255,255,0.4)" }}>Max Neurons</label>
                                        <Input
                                            type="number"
                                            value={neurogenesisConfig.max_neurons}
                                            onChange={v => setNeurogenesisConfig(prev => ({ ...prev, max_neurons: parseInt(v) || 0 }))}
                                        />
                                    </div>
                                    <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8 }}>
                                        <div>
                                            <label style={{ fontSize: 9, color: "rgba(255,255,255,0.4)" }}>Threshold</label>
                                            <Input
                                                type="number"
                                                step="0.05"
                                                value={neurogenesisConfig.threshold}
                                                onChange={v => setNeurogenesisConfig(prev => ({ ...prev, threshold: parseFloat(v) || 0 }))}
                                            />
                                        </div>
                                        <div>
                                            <label style={{ fontSize: 9, color: "rgba(255,255,255,0.4)" }}>Growth Rate</label>
                                            <Input
                                                type="number"
                                                step="0.05"
                                                value={neurogenesisConfig.rate}
                                                onChange={v => setNeurogenesisConfig(prev => ({ ...prev, rate: parseFloat(v) || 0 }))}
                                            />
                                        </div>
                                    </div>
                                    <Button onClick={updateNeurogenesis} style={{ width: "100%" }}>
                                        Update Config
                                    </Button>
                                </div>

                                <div style={{ marginTop: 8, fontSize: 10, color: "rgba(255,255,255,0.3)" }}>
                                    Growth events: {status.growth_events || 0}
                                </div>
                            </Section>

                            {/* Checkpoints */}
                            <Section title="üíæ CHECKPOINTS">
                                <div style={{ display: "flex", gap: 6, marginBottom: 10 }}>
                                    <Button onClick={saveCheckpoint} variant="primary" style={{ flex: 1 }}>
                                        üíæ Save
                                    </Button>
                                    <Button onClick={resetModel} variant="danger" style={{ flex: 1 }}>
                                        üîÑ Reset
                                    </Button>
                                </div>

                                <div style={{ maxHeight: 150, overflowY: "auto" }}>
                                    {checkpoints.length === 0 ? (
                                        <div style={{ textAlign: "center", padding: 10, color: "rgba(255,255,255,0.3)", fontSize: 11 }}>
                                            No checkpoints yet
                                        </div>
                                    ) : (
                                        checkpoints.map((ckpt, i) => (
                                            <div key={i} style={{
                                                display: "flex", justifyContent: "space-between", alignItems: "center",
                                                padding: "6px 8px", marginBottom: 4,
                                                background: "rgba(255,255,255,0.02)",
                                                borderRadius: 6, fontSize: 10
                                            }}>
                                                <div>
                                                    <div style={{ color: "rgba(255,255,255,0.7)" }}>{ckpt.name}</div>
                                                    <div style={{ color: "rgba(255,255,255,0.3)" }}>
                                                        {ckpt.size_mb?.toFixed(1)} MB
                                                    </div>
                                                </div>
                                                <Button
                                                    onClick={() => loadCheckpoint(ckpt.path)}
                                                    style={{ padding: "4px 8px", fontSize: 9 }}
                                                >
                                                    Load
                                                </Button>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </Section>
                        </div>

                        {/* Center: Charts */}
                        <div style={{
                            display: "flex", flexDirection: "column",
                            borderRight: "1px solid rgba(255,255,255,0.05)", overflow: "hidden"
                        }}>
                            {/* Metrics */}
                            <div style={{ padding: "10px 14px", borderBottom: "1px solid rgba(255,255,255,0.05)" }}>
                                <div style={{
                                    display: "grid", gridTemplateColumns: "repeat(4, 1fr)", gap: 8
                                }}>
                                    <MetricCard label="IIT Œ¶" value={metrics.phi || 0} color="#FFD93D" />
                                    <MetricCard label="AGENCY" value={metrics.mean_agency || 0} color="#A8E6CF" />
                                    <MetricCard label="INTEGRATION" value={metrics.integration_score || 0} color="#4ECDC4" />
                                    <MetricCard label="CONFIDENCE" value={metrics.meta_confidence || 0} color="#96CEB4" />
                                </div>
                            </div>

                            {/* Charts */}
                            <div style={{ flex: 1, padding: 10, minHeight: 0 }}>
                                <div style={{ fontSize: 10, color: "rgba(255,255,255,0.3)", fontFamily: "monospace", marginBottom: 6 }}>
                                    METRICS HISTORY
                                </div>
                                <div style={{ height: "calc(100% - 20px)" }}>
                                    <ResponsiveContainer width="100%" height="100%">
                                        <AreaChart data={metricsHistory}>
                                            <Tooltip contentStyle={{
                                                background: "rgba(6,10,18,0.95)",
                                                border: "1px solid rgba(255,255,255,0.1)",
                                                borderRadius: 8, fontSize: 10
                                            }} />
                                            <Area type="monotone" dataKey="phi" stroke="#FFD93D" fill="#FFD93D11" strokeWidth={1.5} />
                                            <Area type="monotone" dataKey="mean_agency" stroke="#A8E6CF" fill="#A8E6CF11" strokeWidth={1.5} />
                                            <Area type="monotone" dataKey="integration_score" stroke="#4ECDC4" fill="#4ECDC411" strokeWidth={1.5} />
                                        </AreaChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                        </div>

                        {/* Right: Neurochemistry + Chat */}
                        <div style={{ display: "flex", flexDirection: "column", overflow: "hidden" }}>
                            {/* Neurochemistry */}
                            <div style={{ padding: 10, borderBottom: "1px solid rgba(255,255,255,0.05)" }}>
                                <div style={{ fontSize: 10, color: "rgba(255,255,255,0.3)", fontFamily: "monospace", marginBottom: 8 }}>
                                    NEUROCHEMISTRY
                                </div>
                                <Gauge label="Dopamine" value={neurochemistry.dopamine} color="#FFD93D" />
                                <Gauge label="Serotonin" value={neurochemistry.serotonin} color="#4ECDC4" />
                                <Gauge label="Oxytocin" value={neurochemistry.oxytocin} color="#A8E6CF" />
                                <Gauge label="Cortisol" value={neurochemistry.cortisol} color="#FF8C42" />
                                <Gauge label="Norepinephrine" value={neurochemistry.norepinephrine} color="#FF6B9D" />
                            </div>

                            {/* Chat */}
                            <div style={{ flex: 1, display: "flex", flexDirection: "column", minHeight: 0 }}>
                                <div style={{ padding: "8px 10px", borderBottom: "1px solid rgba(255,255,255,0.04)" }}>
                                    <span style={{ fontSize: 10, color: "rgba(255,255,255,0.3)", fontFamily: "monospace" }}>
                                        CHAT
                                    </span>
                                </div>

                                <div ref={chatRef} style={{
                                    flex: 1, overflowY: "auto", padding: 10,
                                    display: "flex", flexDirection: "column", gap: 6
                                }}>
                                    {messages.length === 0 ? (
                                        <div style={{
                                            textAlign: "center", padding: 20,
                                            color: "rgba(255,255,255,0.3)", fontSize: 11
                                        }}>
                                            Start conversation...
                                        </div>
                                    ) : (
                                        messages.map((msg, i) => (
                                            <div key={i} style={{
                                                display: "flex", flexDirection: "column",
                                                alignItems: msg.from === "user" ? "flex-end" : "flex-start"
                                            }}>
                                                <div style={{
                                                    maxWidth: "85%", padding: "8px 12px",
                                                    borderRadius: msg.from === "user" ? "12px 12px 4px 12px" : "12px 12px 12px 4px",
                                                    background: msg.from === "user"
                                                        ? "linear-gradient(135deg, #1565C0, #0D47A1)"
                                                        : "rgba(255,255,255,0.06)",
                                                    fontSize: 12, lineHeight: 1.4
                                                }}>
                                                    {msg.text}
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>

                                <div style={{ padding: 10, borderTop: "1px solid rgba(255,255,255,0.05)" }}>
                                    <div style={{ display: "flex", gap: 6 }}>
                                        <input
                                            value={input}
                                            onChange={e => setInput(e.target.value)}
                                            onKeyDown={e => e.key === "Enter" && sendMessage()}
                                            placeholder="Message..."
                                            style={{
                                                flex: 1, padding: "8px 12px", borderRadius: 8,
                                                background: "rgba(255,255,255,0.05)",
                                                border: "1px solid rgba(255,255,255,0.1)",
                                                color: "#fff", fontSize: 12, outline: "none"
                                            }}
                                        />
                                        <Button onClick={sendMessage} variant="primary">‚Üí</Button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<SynapseDashboard />);
    </script>
</body>
</html>
