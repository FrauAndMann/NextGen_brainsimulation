<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYNAPSE Neural Control Center</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.25); }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #050810;
            color: #e4e4e7;
            min-height: 100vh;
            overflow-x: hidden;
        }

        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.6; transform: scale(0.95); } }
        @keyframes glow { 0%, 100% { box-shadow: 0 0 5px currentColor; } 50% { box-shadow: 0 0 20px currentColor, 0 0 30px currentColor; } }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes ripple { 0% { transform: scale(0); opacity: 1; } 100% { transform: scale(4); opacity: 0; } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        @keyframes spike { from { opacity: 1; transform: scaleY(1); } to { opacity: 0; transform: scaleY(0.2); } }
        @keyframes breathe { 0%, 100% { opacity: 0.3; } 50% { opacity: 0.8; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback, useMemo } = React;

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // CONSTANTS & CONFIGURATION
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        const API = "http://localhost:8000";

        const POPULATIONS = [
            { id: "sensory", label: "Sensory Input", color: "#06b6d4", icon: "üëÅÔ∏è" },
            { id: "pred_l1", label: "Prediction L1", color: "#0ea5e9", icon: "üîÆ" },
            { id: "assoc", label: "Association", color: "#10b981", icon: "üß©" },
            { id: "pfc", label: "Prefrontal", color: "#f59e0b", icon: "üéØ" },
            { id: "hippo", label: "Hippocampus", color: "#a855f7", icon: "üíæ" },
            { id: "amygdala", label: "Amygdala", color: "#ef4444", icon: "‚ù§Ô∏è" },
            { id: "selfmodel", label: "Self-Model", color: "#22c55e", icon: "ü™û" },
            { id: "gw_hub", label: "Global Workspace", color: "#eab308", icon: "üåê" },
        ];

        const NEURO = [
            { id: "dopamine", label: "–î–æ—Ñ–∞–º–∏–Ω", color: "#fbbf24", desc: "–ù–∞–≥—Ä–∞–¥–∞, –º–æ—Ç–∏–≤–∞—Ü–∏—è" },
            { id: "serotonin", label: "–°–µ—Ä–æ—Ç–æ–Ω–∏–Ω", color: "#06b6d4", desc: "–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ" },
            { id: "norepinephrine", label: "–ù–æ—Ä–∞–¥—Ä–µ–Ω–∞–ª–∏–Ω", color: "#f43f5e", desc: "–í–Ω–∏–º–∞–Ω–∏–µ, —ç–Ω–µ—Ä–≥–∏—è" },
            { id: "oxytocin", label: "–û–∫—Å–∏—Ç–æ—Ü–∏–Ω", color: "#22c55e", desc: "–°–≤—è–∑—å, –¥–æ–≤–µ—Ä–∏–µ" },
            { id: "cortisol", label: "–ö–æ—Ä—Ç–∏–∑–æ–ª", color: "#f97316", desc: "–°—Ç—Ä–µ—Å—Å, —Ç—Ä–µ–≤–æ–≥–∞" },
        ];

        const DATA_TYPES = [
            { id: "synthetic", label: "–°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ", icon: "üß™", desc: "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è" },
            { id: "images", label: "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è", icon: "üñºÔ∏è", desc: "–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏, –∫–∞—Ä—Ç–∏–Ω–∫–∏" },
            { id: "text", label: "–¢–µ–∫—Å—Ç", icon: "üìù", desc: "–ö–Ω–∏–≥–∏, –¥–æ–∫—É–º–µ–Ω—Ç—ã" },
            { id: "rl", label: "RL –û–∫—Ä—É–∂–µ–Ω–∏–µ", icon: "üéÆ", desc: "OpenAI Gym" },
            { id: "timeseries", label: "–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã", icon: "üìà", desc: "–î–∞—Ç—á–∏–∫–∏, —Ñ–∏–Ω–∞–Ω—Å—ã" },
        ];

        const RL_ENVS = ["CartPole-v1", "MountainCar-v0", "Pendulum-v1", "Acrobot-v1"];

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // UTILITY FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        const clamp = (v, mn = 0, mx = 1) => Math.max(mn, Math.min(mx, v));
        const hexToRgb = (hex) => { const r = parseInt(hex.slice(1,3),16), g = parseInt(hex.slice(3,5),16), b = parseInt(hex.slice(5,7),16); return `${r},${g},${b}`; };
        const formatTime = (secs) => { if (!secs) return "0s"; const h = Math.floor(secs / 3600), m = Math.floor((secs % 3600) / 60), s = Math.floor(secs % 60); return h > 0 ? `${h}h ${m}m` : m > 0 ? `${m}m ${s}s` : `${s}s`; };
        const formatNumber = (n) => n?.toLocaleString() || "0";

        async function api(path, method = "GET", body = null) {
            try {
                const opts = { method, headers: { "Content-Type": "application/json" } };
                if (body) opts.body = JSON.stringify(body);
                const res = await fetch(API + path, opts);
                return await res.json();
            } catch (e) {
                console.error("API error:", e);
                return null;
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // UI COMPONENTS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Button Component
        function Button({ children, onClick, variant = "default", size = "md", disabled, loading, icon, fullWidth }) {
            const variants = {
                default: { bg: "rgba(255,255,255,0.1)", hover: "rgba(255,255,255,0.15)", color: "#fff" },
                primary: { bg: "#06b6d4", hover: "#0891b2", color: "#000" },
                success: { bg: "#22c55e", hover: "#16a34a", color: "#000" },
                warning: { bg: "#f59e0b", hover: "#d97706", color: "#000" },
                danger: { bg: "#ef4444", hover: "#dc2626", color: "#fff" },
                ghost: { bg: "transparent", hover: "rgba(255,255,255,0.05)", color: "rgba(255,255,255,0.7)" },
            };
            const sizes = { sm: { py: 6, px: 12, fs: 11 }, md: { py: 10, px: 16, fs: 13 }, lg: { py: 14, px: 24, fs: 15 } };
            const v = variants[variant] || variants.default;
            const s = sizes[size] || sizes.md;

            return (
                <button
                    onClick={onClick}
                    disabled={disabled || loading}
                    style={{
                        display: "inline-flex", alignItems: "center", justifyContent: "center", gap: 8,
                        padding: `${s.py}px ${s.px}px`, borderRadius: 10, border: "none",
                        background: v.bg, color: v.color, fontSize: s.fs, fontWeight: 500,
                        cursor: disabled ? "not-allowed" : "pointer", opacity: disabled ? 0.5 : 1,
                        transition: "all 0.2s ease", width: fullWidth ? "100%" : "auto",
                        fontFamily: "'Inter', sans-serif", position: "relative", overflow: "hidden",
                    }}
                >
                    {loading && <span style={{ animation: "spin 1s linear infinite" }}>‚è≥</span>}
                    {icon && !loading && <span>{icon}</span>}
                    {children}
                </button>
            );
        }

        // Card Component
        function Card({ children, title, subtitle, icon, action, noPadding, glow, glowColor }) {
            return (
                <div style={{
                    background: "rgba(255,255,255,0.03)",
                    borderRadius: 16, border: "1px solid rgba(255,255,255,0.06)",
                    overflow: "hidden", boxShadow: glow ? `0 0 30px rgba(${hexToRgb(glowColor || "#06b6d4")}, 0.1)` : "none",
                }}>
                    {title && (
                        <div style={{ padding: "16px 20px", borderBottom: "1px solid rgba(255,255,255,0.04)", display: "flex", alignItems: "center", justifyContent: "space-between" }}>
                            <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
                                {icon && <span style={{ fontSize: 18 }}>{icon}</span>}
                                <div>
                                    <div style={{ fontSize: 14, fontWeight: 600, color: "#fff" }}>{title}</div>
                                    {subtitle && <div style={{ fontSize: 11, color: "rgba(255,255,255,0.4)", marginTop: 2 }}>{subtitle}</div>}
                                </div>
                            </div>
                            {action}
                        </div>
                    )}
                    <div style={{ padding: noPadding ? 0 : 16 }}>
                        {children}
                    </div>
                </div>
            );
        }

        // Progress Bar Component
        function ProgressBar({ value, max = 100, color = "#06b6d4", size = "md", showLabel, label }) {
            const percent = Math.min((value / max) * 100, 100);
            const heights = { sm: 4, md: 8, lg: 12 };
            const height = heights[size] || heights.md;

            return (
                <div>
                    {(showLabel || label) && (
                        <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 6 }}>
                            <span style={{ fontSize: 11, color: "rgba(255,255,255,0.5)" }}>{label || "Progress"}</span>
                            <span style={{ fontSize: 12, fontWeight: 600, color }}>{Math.round(percent)}%</span>
                        </div>
                    )}
                    <div style={{ height, background: "rgba(255,255,255,0.08)", borderRadius: height / 2, overflow: "hidden" }}>
                        <div style={{
                            height: "100%", width: `${percent}%`,
                            background: `linear-gradient(90deg, ${color}cc, ${color})`,
                            borderRadius: height / 2,
                            transition: "width 0.5s cubic-bezier(0.4, 0, 0.2, 1)",
                            boxShadow: `0 0 10px ${color}66`,
                        }} />
                    </div>
                </div>
            );
        }

        // Metric Card Component
        function MetricCard({ label, value, target, color, icon, trend }) {
            const percent = target ? Math.min((value / target) * 100, 100) : 0;
            const achieved = target && value >= target;

            return (
                <div style={{
                    padding: 16, borderRadius: 12,
                    background: "rgba(255,255,255,0.02)", border: `1px solid rgba(${hexToRgb(color)}, ${achieved ? 0.3 : 0.1})`,
                    transition: "all 0.3s ease",
                }}>
                    <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 8 }}>
                        {icon && <span style={{ fontSize: 16 }}>{icon}</span>}
                        <span style={{ fontSize: 11, color: "rgba(255,255,255,0.5)", fontWeight: 500 }}>{label}</span>
                        {achieved && <span style={{ fontSize: 10, color: "#22c55e" }}>‚úì</span>}
                    </div>
                    <div style={{ fontSize: 28, fontWeight: 700, color, fontFamily: "'JetBrains Mono', monospace", marginBottom: 4 }}>
                        {typeof value === 'number' ? value.toFixed(3) : value}
                    </div>
                    {target && (
                        <div style={{ fontSize: 10, color: "rgba(255,255,255,0.3)" }}>
                            Target: {target} ({Math.round(percent)}%)
                        </div>
                    )}
                    <div style={{ marginTop: 8 }}>
                        <ProgressBar value={percent} color={color} size="sm" />
                    </div>
                </div>
            );
        }

        // Select Component
        function Select({ value, onChange, options, placeholder, icon }) {
            return (
                <div style={{ position: "relative" }}>
                    <select
                        value={value}
                        onChange={(e) => onChange(e.target.value)}
                        style={{
                            width: "100%", padding: "12px 40px 12px 16px",
                            background: "rgba(255,255,255,0.05)", border: "1px solid rgba(255,255,255,0.1)",
                            borderRadius: 10, color: "#fff", fontSize: 13,
                            fontFamily: "'Inter', sans-serif", cursor: "pointer",
                            appearance: "none", outline: "none",
                        }}
                    >
                        {placeholder && <option value="" disabled>{placeholder}</option>}
                        {options.map(opt => (
                            <option key={opt.id || opt} value={opt.id || opt} style={{ background: "#1a1a2e", color: "#fff" }}>
                                {opt.icon ? `${opt.icon} ` : ''}{opt.label || opt}
                            </option>
                        ))}
                    </select>
                    <span style={{ position: "absolute", right: 14, top: "50%", transform: "translateY(-50%)", pointerEvents: "none", color: "rgba(255,255,255,0.4)" }}>‚ñº</span>
                </div>
            );
        }

        // Input Component
        function Input({ value, onChange, placeholder, type = "text", icon }) {
            return (
                <div style={{ position: "relative" }}>
                    {icon && <span style={{ position: "absolute", left: 14, top: "50%", transform: "translateY(-50%)", color: "rgba(255,255,255,0.3)" }}>{icon}</span>}
                    <input
                        type={type}
                        value={value}
                        onChange={(e) => onChange(e.target.value)}
                        placeholder={placeholder}
                        style={{
                            width: "100%", padding: icon ? "12px 16px 12px 42px" : "12px 16px",
                            background: "rgba(255,255,255,0.05)", border: "1px solid rgba(255,255,255,0.1)",
                            borderRadius: 10, color: "#fff", fontSize: 13,
                            fontFamily: "'Inter', sans-serif", outline: "none",
                            transition: "border-color 0.2s",
                        }}
                    />
                </div>
            );
        }

        // Tabs Component
        function Tabs({ tabs, activeTab, onChange }) {
            return (
                <div style={{ display: "flex", gap: 4, padding: 4, background: "rgba(255,255,255,0.03)", borderRadius: 12 }}>
                    {tabs.map(tab => (
                        <button
                            key={tab.id}
                            onClick={() => onChange(tab.id)}
                            style={{
                                flex: 1, padding: "10px 16px", border: "none", borderRadius: 8,
                                background: activeTab === tab.id ? "rgba(255,255,255,0.1)" : "transparent",
                                color: activeTab === tab.id ? "#fff" : "rgba(255,255,255,0.5)",
                                fontSize: 12, fontWeight: 500, cursor: "pointer",
                                transition: "all 0.2s ease", display: "flex", alignItems: "center", justifyContent: "center", gap: 6,
                            }}
                        >
                            {tab.icon && <span>{tab.icon}</span>}
                            {tab.label}
                        </button>
                    ))}
                </div>
            );
        }

        // Alert Component
        function Alert({ type = "info", children, onClose }) {
            const types = {
                info: { bg: "rgba(6,182,212,0.1)", border: "#06b6d4", icon: "‚ÑπÔ∏è" },
                success: { bg: "rgba(34,197,94,0.1)", border: "#22c55e", icon: "‚úì" },
                warning: { bg: "rgba(245,158,11,0.1)", border: "#f59e0b", icon: "‚ö†Ô∏è" },
                error: { bg: "rgba(239,68,68,0.1)", border: "#ef4444", icon: "‚úï" },
            };
            const t = types[type] || types.info;

            return (
                <div style={{
                    padding: "14px 16px", borderRadius: 12, background: t.bg,
                    border: `1px solid ${t.border}33`, display: "flex", alignItems: "flex-start", gap: 12,
                    animation: "slideIn 0.3s ease",
                }}>
                    <span style={{ fontSize: 16 }}>{t.icon}</span>
                    <div style={{ flex: 1, fontSize: 13, lineHeight: 1.5 }}>{children}</div>
                    {onClose && (
                        <button onClick={onClose} style={{ background: "none", border: "none", color: "rgba(255,255,255,0.5)", cursor: "pointer", fontSize: 18 }}>√ó</button>
                    )}
                </div>
            );
        }

        // Spike Raster Visualization
        function SpikeRaster({ spikes }) {
            return (
                <div style={{ position: "relative", height: "100%", overflow: "hidden", background: "rgba(0,0,0,0.2)", borderRadius: 8 }}>
                    {POPULATIONS.map((pop, i) => (
                        <div key={pop.id} style={{
                            position: "absolute", left: 0, right: 0,
                            top: `${(i / POPULATIONS.length) * 100}%`,
                            height: `${100 / POPULATIONS.length}%`,
                            borderBottom: "1px solid rgba(255,255,255,0.03)",
                            display: "flex", alignItems: "center",
                        }}>
                            <span style={{ fontSize: 9, color: pop.color, width: 32, paddingLeft: 8, fontFamily: "'JetBrains Mono', monospace", opacity: 0.7 }}>
                                {pop.id.slice(0, 4).toUpperCase()}
                            </span>
                            <div style={{ flex: 1, position: "relative", height: "100%" }}>
                                {spikes.filter(s => s.pop?.id === pop.id).map(s => (
                                    <div key={s.id} style={{
                                        position: "absolute", left: `${s.x * 100}%`, top: "50%",
                                        transform: "translateY(-50%)", width: s.size, height: s.size * 2,
                                        background: pop.color, borderRadius: 2,
                                        boxShadow: `0 0 ${s.size * 3}px ${pop.color}`,
                                        animation: "spike 0.2s ease-out forwards",
                                    }} />
                                ))}
                            </div>
                        </div>
                    ))}
                </div>
            );
        }

        // Neuro Gauge Component
        function NeuroGauge({ label, value, color, desc }) {
            return (
                <div style={{
                    padding: "12px 14px", borderRadius: 12,
                    background: "rgba(255,255,255,0.02)",
                    border: `1px solid rgba(${hexToRgb(color)}, 0.15)`,
                }}>
                    <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 6 }}>
                        <span style={{ fontSize: 11, color: "rgba(255,255,255,0.6)" }}>{label}</span>
                        <span style={{ fontSize: 13, fontWeight: 600, color, fontFamily: "'JetBrains Mono', monospace" }}>
                            {Math.round(value * 100)}%
                        </span>
                    </div>
                    <div style={{ height: 6, background: "rgba(255,255,255,0.06)", borderRadius: 3, overflow: "hidden" }}>
                        <div style={{
                            height: "100%", width: `${value * 100}%",
                            background: `linear-gradient(90deg, ${color}99, ${color})`,
                            borderRadius: 3, transition: "width 0.4s ease",
                            boxShadow: `0 0 8px ${color}44`,
                        }} />
                    </div>
                    {desc && <div style={{ fontSize: 9, color: "rgba(255,255,255,0.3)", marginTop: 4 }}>{desc}</div>}
                </div>
            );
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // MAIN APP
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function App() {
            // ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            const [activeTab, setActiveTab] = useState("dashboard");
            const [connected, setConnected] = useState(false);
            const [status, setStatus] = useState({ state: "idle", step: 0, elapsed_seconds: 0 });
            const [metrics, setMetrics] = useState({ phi: 0, agency: 0, integration_score: 0, meta_confidence: 0 });
            const [neurochemistry, setNeurochemistry] = useState({});
            const [checkpoints, setCheckpoints] = useState([]);
            const [messages, setMessages] = useState([]);
            const [chatInput, setChatInput] = useState("");
            const [systemInfo, setSystemInfo] = useState({});

            // Data config state
            const [dataConfig, setDataConfig] = useState({ data_type: "synthetic", data_path: null, env_name: "CartPole-v1" });
            const [scanResult, setScanResult] = useState(null);
            const [scanPath, setScanPath] = useState("");

            // Simulation state for visuals
            const [popActivity, setPopActivity] = useState(() => Object.fromEntries(POPULATIONS.map(p => [p.id, Math.random() * 0.4 + 0.1])));
            const [spikes, setSpikes] = useState([]);
            const [showDataModal, setShowDataModal] = useState(false);

            const wsRef = useRef();
            const chatRef = useRef();

            // ‚îÄ‚îÄ Effects ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

            // WebSocket connection
            useEffect(() => {
                let ws;
                const connect = () => {
                    ws = new WebSocket("ws://localhost:8000/ws");
                    ws.onopen = () => setConnected(true);
                    ws.onmessage = (e) => {
                        const data = JSON.parse(e.data);
                        if (data.state) setStatus(prev => ({ ...prev, ...data }));
                        if (data.phi !== undefined) setMetrics(prev => ({ ...prev, phi: data.phi, agency: data.agency, integration_score: data.integration_score }));
                        if (data.neurochemistry) setNeurochemistry(data.neurochemistry);
                    };
                    ws.onclose = () => { setConnected(false); setTimeout(connect, 2000); };
                    wsRef.current = ws;
                };
                connect();
                return () => ws?.close();
            }, []);

            // Simulation loop for visuals
            useEffect(() => {
                const id = setInterval(() => {
                    setPopActivity(prev => {
                        const next = { ...prev };
                        POPULATIONS.forEach(p => { next[p.id] = clamp(prev[p.id] + (Math.random() - 0.49) * 0.08, 0.02, 0.95); });
                        return next;
                    });
                    setSpikes(Array.from({ length: Math.floor(Math.random() * 15 + 3) }, () => ({
                        x: Math.random(), pop: POPULATIONS[Math.floor(Math.random() * POPULATIONS.length)], size: Math.random() * 3 + 1, id: Math.random()
                    })));
                }, 250);
                return () => clearInterval(id);
            }, []);

            // Load initial data
            useEffect(() => {
                const load = async () => {
                    const s = await api("/api/status"); if (s) setStatus(prev => ({ ...prev, ...s }));
                    const m = await api("/api/metrics"); if (m) setMetrics(prev => ({ ...prev, ...m }));
                    const n = await api("/api/neurochemistry"); if (n) setNeurochemistry(n);
                    const c = await api("/api/checkpoints"); if (c) setCheckpoints(c);
                    const h = await api("/api/chat/history"); if (h) setMessages(h);
                    const dc = await api("/api/data/config"); if (dc) setDataConfig(dc);
                    const si = await api("/api/system/info"); if (si) setSystemInfo(si);
                };
                load();
                const iv = setInterval(load, 3000);
                return () => clearInterval(iv);
            }, []);

            // Scroll chat
            useEffect(() => { if (chatRef.current) chatRef.current.scrollTop = chatRef.current.scrollHeight; }, [messages]);

            // ‚îÄ‚îÄ Actions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

            const startTraining = () => api("/api/training/start", "POST");
            const pauseTraining = () => api("/api/training/pause", "POST");
            const resumeTraining = () => api("/api/training/resume", "POST");
            const stopTraining = () => { if (confirm("–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ? –ü—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω.")) api("/api/training/stop", "POST"); };

            const scanDirectory = async () => {
                if (!scanPath) return;
                const result = await api("/api/data/scan-directory", "POST", { path: scanPath });
                setScanResult(result);
            };

            const setDataPath = async (type, path) => {
                await api("/api/data/config", "POST", { data_type: type, data_path: path });
                setDataConfig(prev => ({ ...prev, data_type: type, data_path: path }));
            };

            const sendChat = async () => {
                if (!chatInput.trim()) return;
                const text = chatInput;
                setChatInput("");
                setMessages(prev => [...prev, { from: "user", text, timestamp: new Date().toISOString() }]);
                const res = await api("/api/chat", "POST", { text });
                if (res) setMessages(prev => [...prev, { from: "brain", text: res.response, timestamp: new Date().toISOString() }]);
            };

            // ‚îÄ‚îÄ Derived values ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

            const isRunning = status.state === "running";
            const isPaused = status.state === "paused";
            const isIdle = status.state === "idle";
            const gwWinner = POPULATIONS.reduce((a, b) => popActivity[a.id] > popActivity[b.id] ? a : b, POPULATIONS[0]);
            const overallProgress = (Math.min(metrics.phi / 0.6, 1) * 35 + Math.min(metrics.agency / 0.7, 1) * 30 + Math.min(metrics.integration_score / 0.6, 1) * 20 + Math.min(metrics.meta_confidence / 0.6, 1) * 15);
            const lifeStage = status.elapsed_seconds < 3600 ? "–ù–æ–≤–æ—Ä–æ–∂–¥—ë–Ω–Ω—ã–π" : status.elapsed_seconds < 86400 ? "–ú–ª–∞–¥–µ–Ω–µ—Ü" : status.elapsed_seconds < 604800 ? "–†–µ–±—ë–Ω–æ–∫" : "–í–∑—Ä–æ—Å–ª—ã–π";

            // ‚îÄ‚îÄ Render ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

            return (
                <div style={{ minHeight: "100vh", display: "flex", flexDirection: "column" }}>
                    {/* Header */}
                    <header style={{
                        padding: "12px 24px", background: "rgba(10,15,25,0.95)", backdropFilter: "blur(20px)",
                        borderBottom: "1px solid rgba(255,255,255,0.05)", position: "sticky", top: 0, zIndex: 100,
                    }}>
                        <div style={{ maxWidth: 1600, margin: "0 auto", display: "flex", alignItems: "center", justifyContent: "space-between" }}>
                            <div style={{ display: "flex", alignItems: "center", gap: 16 }}>
                                <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
                                    <div style={{
                                        width: 10, height: 10, borderRadius: "50%",
                                        background: connected ? "#22c55e" : "#ef4444",
                                        boxShadow: connected ? "0 0 15px #22c55e" : "0 0 15px #ef4444",
                                        animation: "pulse 2s infinite",
                                    }} />
                                    <span style={{ fontSize: 18, fontWeight: 700, letterSpacing: "-0.02em" }}>SYNAPSE</span>
                                </div>
                                <span style={{ fontSize: 11, color: "rgba(255,255,255,0.3)", fontFamily: "'JetBrains Mono', monospace" }}>v3.0</span>
                            </div>

                            <div style={{ display: "flex", alignItems: "center", gap: 24 }}>
                                <div style={{ textAlign: "right" }}>
                                    <div style={{ fontSize: 11, color: "rgba(255,255,255,0.4)" }}>–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
                                    <div style={{ fontSize: 16, fontWeight: 600, color: overallProgress > 50 ? "#22c55e" : "#f59e0b" }}>{Math.round(overallProgress)}%</div>
                                </div>
                                <div style={{ textAlign: "right" }}>
                                    <div style={{ fontSize: 11, color: "rgba(255,255,255,0.4)" }}>–®–∞–≥–∏</div>
                                    <div style={{ fontSize: 16, fontWeight: 600, color: "#06b6d4" }}>{formatNumber(status.step)}</div>
                                </div>
                                <div style={{ textAlign: "right" }}>
                                    <div style={{ fontSize: 11, color: "rgba(255,255,255,0.4)" }}>–í—Ä–µ–º—è</div>
                                    <div style={{ fontSize: 16, fontWeight: 600 }}>{formatTime(status.elapsed_seconds)}</div>
                                </div>
                                <div style={{
                                    padding: "6px 14px", borderRadius: 20, fontSize: 11, fontWeight: 500,
                                    background: isRunning ? "rgba(34,197,94,0.15)" : isPaused ? "rgba(245,158,11,0.15)" : "rgba(255,255,255,0.05)",
                                    color: isRunning ? "#22c55e" : isPaused ? "#f59e0b" : "rgba(255,255,255,0.5)",
                                    border: `1px solid ${isRunning ? "rgba(34,197,94,0.3)" : isPaused ? "rgba(245,158,11,0.3)" : "rgba(255,255,255,0.1)"}`,
                                }}>
                                    {status.state?.toUpperCase() || "IDLE"}
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main style={{ flex: 1, maxWidth: 1600, margin: "0 auto", padding: 24, width: "100%" }}>
                        <div style={{ display: "grid", gridTemplateColumns: "320px 1fr 320px", gap: 20, height: "calc(100vh - 140px)" }}>

                            {/* Left Column */}
                            <div style={{ display: "flex", flexDirection: "column", gap: 16 }}>
                                {/* Training Control */}
                                <Card title="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—É—á–µ–Ω–∏–µ–º" icon="‚ö°" glow={isRunning} glowColor="#22c55e">
                                    <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
                                        {isIdle || isPaused ? (
                                            <Button variant="success" size="lg" fullWidth onClick={isPaused ? resumeTraining : startTraining} icon="‚ñ∂">
                                                {isPaused ? "–ü–†–û–î–û–õ–ñ–ò–¢–¨" : "–ù–ê–ß–ê–¢–¨ –û–ë–£–ß–ï–ù–ò–ï"}
                                            </Button>
                                        ) : null}
                                        {isRunning && (
                                            <Button variant="warning" size="lg" fullWidth onClick={pauseTraining} icon="‚è∏">
                                                –ü–ê–£–ó–ê
                                            </Button>
                                        )}
                                        {!isIdle && (
                                            <Button variant="danger" size="lg" fullWidth onClick={stopTraining} icon="‚èπ">
                                                –û–°–¢–ê–ù–û–í–ò–¢–¨
                                            </Button>
                                        )}
                                    </div>

                                    <div style={{ marginTop: 16, padding: 12, background: "rgba(255,255,255,0.02)", borderRadius: 8 }}>
                                        <div style={{ fontSize: 11, color: "rgba(255,255,255,0.4)", marginBottom: 8 }}>–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö</div>
                                        <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
                                            <span style={{ fontSize: 20 }}>{DATA_TYPES.find(d => d.id === dataConfig.data_type)?.icon}</span>
                                            <div>
                                                <div style={{ fontSize: 13, fontWeight: 500 }}>{DATA_TYPES.find(d => d.id === dataConfig.data_type)?.label}</div>
                                                <div style={{ fontSize: 10, color: "rgba(255,255,255,0.4)" }}>{DATA_TYPES.find(d => d.id === dataConfig.data_type)?.desc}</div>
                                            </div>
                                        </div>
                                    </div>

                                    <Button variant="ghost" fullWidth style={{ marginTop: 12 }} onClick={() => setShowDataModal(true)} icon="üìÅ">
                                        –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                                    </Button>
                                </Card>

                                {/* Metrics */}
                                <Card title="–ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–∑–Ω–∞–Ω–∏—è" icon="üß†" subtitle={`Œ¶ = ${metrics.phi.toFixed(3)}`}>
                                    <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
                                        <MetricCard label="Œ¶ (Phi)" value={metrics.phi} target={0.6} color="#eab308" icon="‚àû" />
                                        <MetricCard label="Agency" value={metrics.agency} target={0.7} color="#22c55e" icon="üéØ" />
                                    </div>
                                    <div style={{ marginTop: 10 }}>
                                        <MetricCard label="Integration" value={metrics.integration_score} target={0.6} color="#06b6d4" icon="üîó" />
                                    </div>
                                </Card>

                                {/* Progress */}
                                <Card title="–ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è" icon="üìà">
                                    <ProgressBar value={overallProgress} color={overallProgress > 50 ? "#22c55e" : overallProgress > 25 ? "#f59e0b" : "#ef4444"} size="lg" showLabel label="–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å" />
                                    <div style={{ marginTop: 12, display: "flex", flexDirection: "column", gap: 8 }}>
                                        <ProgressBar value={metrics.phi * 100 / 0.6} color="#eab308" size="sm" />
                                        <ProgressBar value={metrics.agency * 100 / 0.7} color="#22c55e" size="sm" />
                                    </div>
                                </Card>
                            </div>

                            {/* Center Column */}
                            <div style={{ display: "flex", flexDirection: "column", gap: 16 }}>
                                {/* Spike Raster */}
                                <Card title="–ù–µ–π—Ä–æ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å" icon="‚ö°" subtitle={`${spikes.length} —Å–ø–∞–π–∫–æ–≤`} noPadding>
                                    <div style={{ height: 180, padding: "0 8px 8px" }}>
                                        <SpikeRaster spikes={spikes} />
                                    </div>
                                </Card>

                                {/* Population Activity */}
                                <Card title="–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ø—É–ª—è—Ü–∏–π" icon="üîÆ">
                                    <div style={{ display: "flex", flexDirection: "column", gap: 6 }}>
                                        {POPULATIONS.map(pop => {
                                            const value = popActivity[pop.id];
                                            const isWinner = gwWinner.id === pop.id;
                                            return (
                                                <div key={pop.id} style={{ display: "flex", alignItems: "center", gap: 10 }}>
                                                    <div style={{ width: 4, height: 24, borderRadius: 2, background: isWinner ? pop.color : `${pop.color}44`, boxShadow: isWinner ? `0 0 8px ${pop.color}` : "none", transition: "all 0.3s" }} />
                                                    <span style={{ fontSize: 11, color: isWinner ? pop.color : "rgba(255,255,255,0.5)", width: 70, fontFamily: "'JetBrains Mono', monospace" }}>{pop.label}</span>
                                                    <div style={{ flex: 1, height: 4, background: "rgba(255,255,255,0.05)", borderRadius: 2, overflow: "hidden" }}>
                                                        <div style={{ height: "100%", width: `${value * 100}%`, background: pop.color, borderRadius: 2, transition: "width 0.3s" }} />
                                                    </div>
                                                    {isWinner && <span style={{ fontSize: 10, color: pop.color }}>‚òÖ</span>}
                                                </div>
                                            );
                                        })}
                                    </div>
                                </Card>

                                {/* Status Info */}
                                <Card title="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ" icon="üíª" style={{ flex: 1 }}>
                                    <div style={{ fontFamily: "'JetBrains Mono', monospace", fontSize: 11, lineHeight: 1.8, color: "rgba(255,255,255,0.6)" }}>
                                        <div>–°–æ—Å—Ç–æ—è–Ω–∏–µ: <span style={{ color: "#06b6d4" }}>{status.state?.toUpperCase()}</span></div>
                                        <div>–®–∞–≥–æ–≤: <span style={{ color: "#fff" }}>{formatNumber(status.step)}</span></div>
                                        <div>–°–µ–º–ø–ª–æ–≤: <span style={{ color: "#fff" }}>{formatNumber(status.total_samples)}</span></div>
                                        <div>GPU: <span style={{ color: systemInfo.cuda_available ? "#22c55e" : "#ef4444" }}>{systemInfo.gpu_name || "CPU"}</span></div>
                                        <div style={{ marginTop: 8, paddingTop: 8, borderTop: "1px solid rgba(255,255,255,0.05)" }}>
                                            <div>Œ¶: <span style={{ color: "#eab308" }}>{metrics.phi.toFixed(4)}</span> (target: 0.6)</div>
                                            <div>Agency: <span style={{ color: "#22c55e" }}>{metrics.agency.toFixed(4)}</span> (target: 0.7)</div>
                                            <div>Integration: <span style={{ color: "#06b6d4" }}>{(metrics.integration_score || 0).toFixed(4)}</span></div>
                                        </div>
                                    </div>
                                </Card>
                            </div>

                            {/* Right Column */}
                            <div style={{ display: "flex", flexDirection: "column", gap: 16 }}>
                                {/* Neurochemistry */}
                                <Card title="–ù–µ–π—Ä–æ—Ö–∏–º–∏—è" icon="üß™">
                                    <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
                                        {NEURO.map(n => (
                                            <NeuroGauge key={n.id} {...n} value={neurochemistry[n.id] || 0.5} />
                                        ))}
                                    </div>
                                </Card>

                                {/* Chat */}
                                <Card title="–ß–∞—Ç —Å SYNAPSE" icon="üí¨" style={{ flex: 1 }} noPadding>
                                    <div style={{ display: "flex", flexDirection: "column", height: 300 }}>
                                        <div ref={chatRef} style={{ flex: 1, overflowY: "auto", padding: 16 }}>
                                            {messages.length === 0 ? (
                                                <div style={{ textAlign: "center", padding: 20, color: "rgba(255,255,255,0.3)" }}>
                                                    <div style={{ fontSize: 32, marginBottom: 8 }}>üí¨</div>
                                                    <div style={{ fontSize: 12 }}>–ù–∞—á–Ω–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä —Å–æ –º–Ω–æ–π</div>
                                                    <div style={{ fontSize: 10, marginTop: 4, color: "rgba(255,255,255,0.2)" }}>–ü–æ–ø—Ä–æ–±—É–π: "–ö–∞–∫ —Ç—ã?" –∏–ª–∏ "–ü—Ä–æ–≥—Ä–µ—Å—Å"</div>
                                                </div>
                                            ) : (
                                                messages.map((msg, i) => (
                                                    <div key={i} style={{ marginBottom: 12, textAlign: msg.from === "user" ? "right" : "left" }}>
                                                        <div style={{
                                                            display: "inline-block", maxWidth: "85%", padding: "10px 14px",
                                                            borderRadius: msg.from === "user" ? "16px 16px 4px 16px" : "16px 16px 16px 4px",
                                                            background: msg.from === "user" ? "linear-gradient(135deg, #0891b2, #0e7490)" : "rgba(255,255,255,0.05)",
                                                            fontSize: 12, lineHeight: 1.5, color: "#fff",
                                                        }}>
                                                            {msg.text}
                                                        </div>
                                                    </div>
                                                ))
                                            )}
                                        </div>
                                        <div style={{ padding: 12, borderTop: "1px solid rgba(255,255,255,0.05)" }}>
                                            <div style={{ display: "flex", gap: 8 }}>
                                                <input
                                                    value={chatInput}
                                                    onChange={e => setChatInput(e.target.value)}
                                                    onKeyDown={e => e.key === "Enter" && sendChat()}
                                                    placeholder="–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
                                                    style={{
                                                        flex: 1, padding: "10px 14px", background: "rgba(255,255,255,0.05)",
                                                        border: "1px solid rgba(255,255,255,0.1)", borderRadius: 10, color: "#fff",
                                                        fontSize: 12, outline: "none",
                                                    }}
                                                />
                                                <Button onClick={sendChat} variant="primary">‚Üí</Button>
                                            </div>
                                            <div style={{ display: "flex", gap: 6, marginTop: 8, flexWrap: "wrap" }}>
                                                {["–ö–∞–∫ —Ç—ã?", "–ü—Ä–æ–≥—Ä–µ—Å—Å", "–°–æ–≤–µ—Ç"].map(q => (
                                                    <button key={q} onClick={() => { setChatInput(q); setTimeout(sendChat, 100); }}
                                                        style={{
                                                            padding: "4px 10px", borderRadius: 12, border: "1px solid rgba(255,255,255,0.1)",
                                                            background: "rgba(255,255,255,0.03)", color: "rgba(255,255,255,0.5)",
                                                            fontSize: 10, cursor: "pointer",
                                                        }}>
                                                        {q}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </Card>
                            </div>
                        </div>
                    </main>

                    {/* Data Configuration Modal */}
                    {showDataModal && (
                        <div style={{
                            position: "fixed", inset: 0, background: "rgba(0,0,0,0.8)", backdropFilter: "blur(4px)",
                            display: "flex", alignItems: "center", justifyContent: "center", zIndex: 1000,
                        }}>
                            <div style={{
                                width: 600, maxHeight: "80vh", overflowY: "auto",
                                background: "#0f1419", borderRadius: 20, border: "1px solid rgba(255,255,255,0.1)",
                                boxShadow: "0 25px 50px -12px rgba(0,0,0,0.5)",
                            }}>
                                <div style={{ padding: "20px 24px", borderBottom: "1px solid rgba(255,255,255,0.05)", display: "flex", justifyContent: "space-between", alignItems: "center" }}>
                                    <h2 style={{ fontSize: 18, fontWeight: 600 }}>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è</h2>
                                    <button onClick={() => setShowDataModal(false)} style={{ background: "none", border: "none", color: "rgba(255,255,255,0.5)", fontSize: 24, cursor: "pointer" }}>√ó</button>
                                </div>
                                <div style={{ padding: 24 }}>
                                    <Alert type="info">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –∏ —É–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –¥–∞–Ω–Ω—ã–º (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)</Alert>

                                    <div style={{ marginTop: 20 }}>
                                        <div style={{ fontSize: 12, color: "rgba(255,255,255,0.5)", marginBottom: 8 }}>–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö</div>
                                        <Select
                                            value={dataConfig.data_type}
                                            onChange={(v) => setDataConfig(prev => ({ ...prev, data_type: v }))}
                                            options={DATA_TYPES.map(d => ({ id: d.id, label: `${d.icon} ${d.label}`, icon: d.icon }))}
                                        />
                                    </div>

                                    {dataConfig.data_type !== "synthetic" && dataConfig.data_type !== "rl" && (
                                        <div style={{ marginTop: 16 }}>
                                            <div style={{ fontSize: 12, color: "rgba(255,255,255,0.5)", marginBottom: 8 }}>–ü—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å –¥–∞–Ω–Ω—ã–º–∏</div>
                                            <div style={{ display: "flex", gap: 8 }}>
                                                <Input
                                                    value={scanPath}
                                                    onChange={setScanPath}
                                                    placeholder="D:\Photos –∏–ª–∏ D:\Books"
                                                    icon="üìÅ"
                                                />
                                                <Button onClick={scanDirectory}>–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</Button>
                                            </div>
                                        </div>
                                    )}

                                    {dataConfig.data_type === "rl" && (
                                        <div style={{ marginTop: 16 }}>
                                            <div style={{ fontSize: 12, color: "rgba(255,255,255,0.5)", marginBottom: 8 }}>RL –û–∫—Ä—É–∂–µ–Ω–∏–µ</div>
                                            <Select
                                                value={dataConfig.env_name}
                                                onChange={(v) => setDataConfig(prev => ({ ...prev, env_name: v }))}
                                                options={RL_ENVS.map(e => ({ id: e, label: e }))}
                                            />
                                        </div>
                                    )}

                                    {scanResult && (
                                        <div style={{ marginTop: 16, padding: 16, background: "rgba(255,255,255,0.02)", borderRadius: 12 }}>
                                            <div style={{ fontSize: 12, fontWeight: 500, marginBottom: 8 }}>–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:</div>
                                            <div style={{ fontSize: 11, color: "rgba(255,255,255,0.6)", lineHeight: 1.6 }}>
                                                <div>–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤: {scanResult.total_files}</div>
                                                <div>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: {scanResult.images.count}</div>
                                                <div>–¢–µ–∫—Å—Ç–æ–≤—ã—Ö: {scanResult.text.count}</div>
                                            </div>
                                        </div>
                                    )}

                                    <div style={{ marginTop: 24, display: "flex", gap: 12 }}>
                                        <Button variant="primary" fullWidth onClick={async () => {
                                            await api("/api/data/config", "POST", dataConfig);
                                            setShowDataModal(false);
                                        }}>
                                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                                        </Button>
                                        <Button variant="ghost" onClick={() => setShowDataModal(false)}>–û—Ç–º–µ–Ω–∞</Button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Mount
        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<App />);
    </script>
</body>
</html>
